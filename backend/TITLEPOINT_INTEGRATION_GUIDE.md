# TitlePoint Integration Implementation Guide\n\n## Overview\nThis document outlines the complete TitlePoint integration for DeedPro, replacing SiteX with a streamlined Google Places + TitlePoint workflow.\n\n## üèóÔ∏è Architecture\n\n### Frontend (Vercel)\n- **PropertySearch.tsx**: Google Places autocomplete with Search button\n- **Integration**: Merged into deed creation wizard at `/create-deed`\n- **Flow**: Address select ‚Üí Search button ‚Üí TitlePoint API call ‚Üí Form population\n\n### Backend (Render)\n- **TitlePoint Service**: SOAP API integration with XML parsing\n- **API Endpoint**: `/api/property/search` for frontend requests\n- **Caching**: PostgreSQL property_cache table (90-day retention)\n\n## üîß Environment Variables\n\n### Frontend (Vercel Dashboard)\n```\nNEXT_PUBLIC_GOOGLE_API_KEY=your_google_places_api_key\nNEXT_PUBLIC_API_URL=https://your-render-backend-url.onrender.com\n```\n\n### Backend (Render Dashboard)\n```\nTITLEPOINT_USER_ID=PCTXML01\nTITLEPOINT_PASSWORD=AlphaOmega637#\nGOOGLE_API_KEY=your_google_places_api_key\nDATABASE_URL=postgresql://...\nOPENAI_API_KEY=sk-proj-...\n```\n\n## üìä Data Flow\n\n1. **User Input**: Types address in Google Places autocomplete\n2. **Address Selection**: User selects from suggestions, extracts components\n3. **Search Trigger**: User clicks \"Search\" button\n4. **Backend Processing**: \n   - Check cache for existing data\n   - Call TitlePoint API (CreateService3)\n   - Parse XML response for APN, legal description, owners\n   - Cache results in PostgreSQL\n   - Return JSON to frontend\n5. **Form Population**: Frontend merges TitlePoint data into deed form fields\n\n## üéØ TitlePoint Data Mapping\n\n| TitlePoint Field | Deed Form Field | Description |\n|-----------------|-----------------|-------------|\n| PropertyProfile.APN | apn | Assessor's Parcel Number |\n| PropertyProfile.LegalBriefDescription | legalDescription | Brief legal description |\n| PropertyProfile.OwnerName.Primary | grantorName | Current primary owner |\n| PropertyProfile.OwnerName.Secondary | secondaryOwner | Current secondary owner |\n\n## üöÄ Deployment Steps\n\n### 1. Frontend Deployment (Vercel)\n```bash\n# Dependencies already installed:\n# - react-places-autocomplete\n# - @googlemaps/js-api-loader\n\n# Files updated:\n# - frontend/components/PropertySearch.tsx\n# - frontend/src/app/create-deed/page.tsx\n\n# Environment variables set in Vercel dashboard\ngit push # Auto-deploys to Vercel\n```\n\n### 2. Backend Deployment (Render)\n```bash\n# Dependencies installed:\n# - zeep (SOAP client)\n# - xmltodict (XML parsing)\n\n# Files updated:\n# - backend/services/titlepoint_service.py\n# - backend/api/property_endpoints.py\n# - backend/database.py (property_cache table)\n# - backend/requirements.txt\n\n# Environment variables set in Render dashboard\ngit push # Auto-deploys to Render\n```\n\n### 3. Database Migration\nThe property_cache table will be automatically created when the backend starts up (via create_tables() in database.py).\n\n## üß™ Testing\n\n### Production Testing Script\n```bash\ncd backend\npython test_titlepoint_integration.py\n```\n\n### Manual Testing Flow\n1. Go to https://deedpro-frontend-new.vercel.app/create-deed\n2. Start typing an address in the property search field\n3. Select an address from Google Places suggestions\n4. Click the \"Search\" button\n5. Verify TitlePoint data populates in the form fields\n6. Check for APN, legal description, and owner information\n\n## üìà Performance & Caching\n\n- **Cache Duration**: 90 days per property\n- **Cache Key**: user_id + address + state + county\n- **Fallback**: Manual entry if TitlePoint returns no data\n- **Error Handling**: Graceful degradation to Google Places data\n\n## üîç Monitoring\n\n### Key Metrics to Track\n- TitlePoint API response times\n- Cache hit rates\n- Search success rates\n- User form completion rates\n\n### Log Points\n- TitlePoint API calls\n- Cache hits/misses\n- Error conditions\n- Form population success\n\n## üõ†Ô∏è Troubleshooting\n\n### Common Issues\n1. **Google Places not loading**: Check NEXT_PUBLIC_GOOGLE_API_KEY\n2. **TitlePoint errors**: Verify TITLEPOINT_USER_ID and TITLEPOINT_PASSWORD\n3. **Cache issues**: Check DATABASE_URL and property_cache table\n4. **CORS errors**: Verify ALLOWED_ORIGINS includes Vercel domain\n\n### Debug Tools\n- Backend test script: `python test_titlepoint_integration.py`\n- Browser console for frontend errors\n- Render logs for backend issues\n- Database queries for cache inspection\n\n## üìã Success Criteria\n\n‚úÖ **Completed Implementation**\n- [x] Google Places autocomplete integration\n- [x] TitlePoint SOAP API service\n- [x] Property search API endpoint\n- [x] Database caching system\n- [x] Frontend form integration\n- [x] Production environment configuration\n- [x] Error handling and fallbacks\n- [x] Testing and validation tools\n\nThe TitlePoint integration is now **production-ready** and deployed! üöÄ\n"
